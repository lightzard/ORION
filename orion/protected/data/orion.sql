CREATE SCHEMA ORION;

CREATE TABLE PENGGUNA (
	username VARCHAR(20) NOT NULL,
	password VARCHAR(20) NOT NULL,
	PRIMARY KEY (username));
	
CREATE TABLE ADMINS (
	username_admin VARCHAR(20) NOT NULL,
	password_admin VARCHAR(20) NOT NULL,
	PRIMARY KEY (username_admin),
	FOREIGN KEY (username_admin) REFERENCES PENGGUNA (username) ON DELETE RESTRICT ON UPDATE CASCADE); 
	
CREATE TABLE MAHASISWA (
	mhs_username VARCHAR(20) NOT NULL,
	npm CHAR(10) NOT NULL UNIQUE,
	nama VARCHAR(30) NOT NULL,
	email VARCHAR(25) NOT NULL,
	foto TEXT,
	ipk NUMERIC(4.2),
	list_prestasi TEXT,
	PRIMARY KEY (mhs_username, npm),
	FOREIGN KEY (mhs_username) REFERENCES PENGGUNA (username) ON DELETE RESTRICT ON UPDATE CASCADE); 
	
CREATE TABLE DOSEN (
	dosen_username VARCHAR(20) NOT NULL,
	nip CHAR(10) NOT NULL UNIQUE,
	nama VARCHAR(30) NOT NULL,
	email VARCHAR(25) NOT NULL,
	foto TEXT,
	list_publikasi TEXT,
	PRIMARY KEY (dosen_username, nip),
	FOREIGN KEY (dosen_username) REFERENCES PENGGUNA (username) ON DELETE RESTRICT ON UPDATE CASCADE); 

CREATE TABLE TOPIK_RISET (
	id VARCHAR(20) NOT NULL UNIQUE,
	judul VARCHAR(30) NOT NULL,
	deskripsi TEXT NOT NULL,
	req TEXT NOT NULL,
	dosen_username VARCHAR(20) NOT NULL,
	admin_username VARCHAR(20) NOT NULL,
	PRIMARY KEY (id),
	FOREIGN KEY (admin_username) REFERENCES ADMINS (username_admin) ON DELETE RESTRICT ON UPDATE CASCADE,
	FOREIGN KEY (dosen_username) REFERENCES DOSEN (dosen_username) ON DELETE RESTRICT ON UPDATE CASCADE); 

CREATE TABLE MESSAGE (
	id VARCHAR(20) NOT NULL UNIQUE,
	tanggal CHAR(8) NOT NULL,
	isi TEXT NOT NULL,
	subject TEXT NOT NULL,
	dosen_username VARCHAR(20) NOT NULL,
	mhs_username VARCHAR(20) NOT NULL,
	PRIMARY KEY (id),
	FOREIGN KEY (mhs_username) REFERENCES MAHASISWA (mhs_username) ON DELETE RESTRICT ON UPDATE CASCADE,
	FOREIGN KEY (dosen_username) REFERENCES DOSEN (dosen_username) ON DELETE RESTRICT ON UPDATE CASCADE); 
	
CREATE TABLE PELAMARAN (
	id VARCHAR(20) NOT NULL UNIQUE,
	tanggal DATE NOT NULL,
	status BOOLEAN NOT NULL,
	message_id VARCHAR(20) NOT NULL,
	topik_id VARCHAR(20) NOT NULL,
	dosen_username VARCHAR(20) NOT NULL,
	mhs_username VARCHAR(20) NOT NULL,
	PRIMARY KEY (id),
	FOREIGN KEY (message_id) REFERENCES MESSAGE (id) ON DELETE RESTRICT ON UPDATE CASCADE,
	FOREIGN KEY (topik_id) REFERENCES TOPIK_RISET (id) ON DELETE RESTRICT ON UPDATE CASCADE,
	FOREIGN KEY (dosen_username) REFERENCES DOSEN (dosen_username) ON DELETE RESTRICT ON UPDATE CASCADE,
	FOREIGN KEY (mhs_username) REFERENCES MAHASISWA (mhs_username) ON DELETE RESTRICT ON UPDATE CASCADE);
	
CREATE TABLE PENCARIAN (
	id VARCHAR(20) NOT NULL UNIQUE,
	keyword TEXT NOT NULL,
	byTopic SMALLINT NOT NULL,
	PRIMARY KEY (id));
	
CREATE TABLE DO_PENCARIAN (
	id VARCHAR(20) NOT NULL UNIQUE,
	username VARCHAR(20) NOT NULL,
	PRIMARY KEY (id, username),
	FOREIGN KEY (id) REFERENCES PENCARIAN (id) ON DELETE RESTRICT ON UPDATE CASCADE,
	FOREIGN KEY (username) REFERENCES pengguna (username) ON DELETE RESTRICT ON UPDATE CASCADE);
	
	
CREATE TABLE TERHADAP_PENCARIAN (
	id_pencarian VARCHAR(20) NOT NULL UNIQUE,
	id_topik VARCHAR(20) NOT NULL UNIQUE,
	PRIMARY KEY (id_pencarian, id_topik),
	FOREIGN KEY (id_pencarian) REFERENCES PENCARIAN(id) ON DELETE RESTRICT ON UPDATE CASCADE,
	FOREIGN KEY (id_topik) REFERENCES TOPIK_RISET(id) ON DELETE RESTRICT ON UPDATE CASCADE);
	